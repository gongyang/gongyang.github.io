---
title : linux 路由表
date: 2016-5-29
---
我们知道，同一个局域网里面，我们可以通过ip广播的方式来实现数据传递的目的。但是不是同一个局域网内的数据传递，就需要路由器来实现了。

假设我们一台主机A（192.168.1.100/24），主机B（192.168.2.100/24），它们是不同的网段，所以不能直接通讯。那A是怎么知道B不是同一个网段了，当然是通过Net_ID（网络号码）来区分的。一个完整的IP是由Net_ID（网络号码）和Host_ID（主机号码）组成，Net_ID是用来区分是不是同一个网段，而Host_ID是用来区分不同主机的。一台主机需要发送数据，主要是通过参考本机的路由表来决定。

### 查看主机路由表
在linux系统下面，我们可以通过route这条命令查看一下本机的路由信息
```
[root@gy-vm02 ~]# route 
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
192.168.1.0     *               255.255.255.0   U     0      0        0 eth0
192.168.168.0   *               255.255.255.0   U     0      0        0 eth1
link-local      *               255.255.0.0     U     1002   0        0 eth0
link-local      *               255.255.0.0     U     1003   0        0 eth1
172.17.0.0      *               255.255.0.0     U     0      0        0 docker0
default         192.168.1.1     0.0.0.0         UG    0      0        0 eth0
```
一般我们会加上参数-n，将主机名以 IP 的方式显示
```
[root@gy-vm02 ~]# route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0
192.168.168.0   0.0.0.0         255.255.255.0   U     0      0        0 eth1
169.254.0.0     0.0.0.0         255.255.0.0     U     1002   0        0 eth0
169.254.0.0     0.0.0.0         255.255.0.0     U     1003   0        0 eth1
172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0
0.0.0.0         192.168.1.1     0.0.0.0         UG    0      0        0 eth0
```
上面输出的数据共有八个字段，你需要注意的有几个地方：
 Destination ：其实就是 Network 的意思；
 Gateway     ：就是该接口的 Gateway 那个 IP ，若为 0.0.0.0 表示不需要额外的 IP；
 Genmask     ：就是 Netmask 啦，与 Destination 组合成为一部主机或网域；
 Flags       ：共有多个标志可以来表示该网域或主机代表的意义：

-               U：代表该路由可用；
-              G：代表该网域需要经由 Gateway 来帮忙转递；
-               H：代表该行路由为一部主机，而非一整个网域；

Iface       ：就是 Interface (接口) 的意思。

上面的信息就是我本机的路由表信息，如果我们有个数据包目的IP是192.168.1.0/24网段的，那么就会选择第一条路由，并且通过eth0这个接口发送出去。同理，如果我们有个数据包目的IP是192.168.168.0/24网段的，那么就会选择第二条路由，并且通过eth1这个接口发送出去。如果目的IP不在路由表的规则里面，那么就会将数据包传送到Flags带有G的那条路由规则里面，也就是192.168.1.1这个Gateway。

### 添加路由信息
上面，我们通过route这条命令，可以看到本机的路由信息，那么这些信息是如何产生的了？
首先，192.168.1.0/24和192.168.168.0/24这两条路由信息的存在是因为我们本机有192.168.1.109和192.168.168.11这两个ip。也就是说，主机上面有几个网络接口，就会存在几条对应的路由信息。下面我来添加一个虚拟接口来验证一下：
```
[root@gy-vm02 ~]# ifconfig eth0:0 192.168.2.100
```
再来查看一下路由信息
```
[root@gy-vm02 ~]# route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
192.168.2.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0
192.168.168.0   0.0.0.0         255.255.255.0   U     0      0        0 eth1
169.254.0.0     0.0.0.0         255.255.0.0     U     1002   0        0 eth0
169.254.0.0     0.0.0.0         255.255.0.0     U     1003   0        0 eth1
172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0
0.0.0.0         192.168.1.1     0.0.0.0         UG    0      0        0 eth0
```
系统自动添加了192.168.2.0/24这条路由信息。

#### 手动添加路由
我们可以通过route这条命令手动添加路由信息，但是需要注意的一点就是，**我们所添加的路由，必须是我们主机上的设备（网络接口）或IP可以直接连接的才行。**
举个例子：我们现在有个路由器IP为192.168.10.254，我们想要连接到这个路由器，可以运行下面的命令：
```
[root@gy-vm02 ~]# route add -net 192.168.10.0 netmask 255.255.255.0 gw 192.168.10.254
SIOCADDRT: No such process
```
系统提示，不能连接到该网络，应为我们的网络接口与192.168.10.0/24根本就没有关系。那如果192.168.10.254真的是我们的实体网络连接，并且是通过eth0连接在一起的，那其实我们可以这样做：
```
[root@gy-vm02 ~]# route add -net 192.168.10.0 netmask 255.255.255.0 dev eth0
[root@gy-vm02 ~]# route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
192.168.2.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0
192.168.168.0   0.0.0.0         255.255.255.0   U     0      0        0 eth1
192.168.10.0    0.0.0.0         255.255.255.0   U     0      0        0 eth0
169.254.0.0     0.0.0.0         255.255.0.0     U     1002   0        0 eth0
169.254.0.0     0.0.0.0         255.255.0.0     U     1003   0        0 eth1
172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0
0.0.0.0         192.168.1.1     0.0.0.0         UG    0      0        0 eth0
```
这样，主机就可以通过eth0去连接192.168.10.254了。


